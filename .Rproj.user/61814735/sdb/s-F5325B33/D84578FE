{
    "collab_server" : "",
    "contents" : "---\ntitle: \"hw05\"\nauthor: \"Victoria Michalowski\"\ndate: \"October 20, 2017\"\noutput: github_document\n---\nI chose to explore GAPMINDER data for this homework.\n\n```{r setup, echo=TRUE, message=F, warning=F}\nknitr::opts_chunk$set(fig.align=\"center\")\n\nsuppressPackageStartupMessages(library(gapminder))\nsuppressPackageStartupMessages(library(tidyverse))\nsuppressPackageStartupMessages(library(forcats))\nsuppressPackageStartupMessages(library(readr))\nsuppressPackageStartupMessages(library(RColorBrewer))\n```\n\n#FACTOR MANAGEMENT\n\n1. First I took a look at the original data for gapminder, to get a flavour of the number of rows, levels, and entries per level.\n\n```{r}\n#the original data\nnrow(gapminder) #n rows for Oceania = 24; total rows = 1704\nfct_count(gapminder$continent)\n```\n\nUsing these functions, I can see that there are 1704 rows in total, and 24 of these correspond with Oceania entries. So by the time I remove Oceania entries, I'll know everything worked as I expected if I end up with 1704 - 24 = 1680 rows. \n\n\nThere are also 5 levels for the continent factor. Assuming I drop Oceania correctly, then I should end up with 4 levels for continent.\n```{r}\nnlevels(gapminder$continent)\n```\n\nThe information I just pulled can also be nicely summarized with the fct_count().\n\n```{r}\nfct_count(gapminder$continent)\n```\n\nNow I'm ready to drop Oceania, such that I can now filter gapminder data to remove observations associated with the continent of Oceania.\n\n```{r}\nxOcn_gapminder <- gapminder %>% #drop Oceania\n  filter(continent!=\"Oceania\") #keep all continents excpet for Oceania\n```\n\nAdditionally, I can remove all unused factor levels, now that Oceania has no observations associated with it.\n\n```{r}\nxOcn_gapminder1 <- xOcn_gapminder %>% #remove unused factor levels\n  droplevels()\n```\n\nLet's see if the data turned out how I had intentioned it to.\n\n```{r}\nnrow(xOcn_gapminder1) #1704 - 24 = 1680 = n total rows for current data\n```\n\nLooking at the number of rows in the new data, we can see that there are indeed 1680 rows, as expected.\n\nHow are the levels looking?\n\n```{r}\nnlevels(xOcn_gapminder1$continent)\n```\n\nI now have 4 levels, as expected.\n\nAnd finally, let's look this is a nice summarized way with fct_count().\n\n```{r}\nfct_count(xOcn_gapminder1$continent)\n```\n\n\n2. Next up is reordering the levels of continent. Here, I use the forcats package to change the order of factor levels, based on a principled summary (the mean in my case) of one of the quantitative variables (I chose life expectancy).\n\nLooking at the data as it is before I reorder anything, we can see that continents are alphabetically ordered - this is arbitrary, and not very informative.\n\n```{r}\nlevels(xOcn_gapminder1$continent) \n```\n\nIt would be much more information to order continents in some meaningful way, such as by mean life expectancy.\n\n```{r}\nxOcn_gapminder2 <- fct_reorder(xOcn_gapminder1$continent, xOcn_gapminder1$lifeExp, mean) %>% \n  levels()\n```\n\nLet's take a look at what the data looks like now:\n\n```{r}\nhead(xOcn_gapminder2)\n```\n\nNow it's clear which continent has the highest mean life expectancy (Europe), and which has the lowest (Africa), just from the order of continents.\n\nHowever, it would be more intuitive for me to have them ordered backwards, from highest mean life expectancy to lowest:\n\n```{r}\nxOcn_gapminder3 <- fct_reorder(xOcn_gapminder1$continent, xOcn_gapminder1$lifeExp, .desc=TRUE) %>% \n  levels()\n```\n\nAnd taking a look at the new data, the continent factor is now ordered from highest to lowest life expectancy.\n\n```{r}\nhead(xOcn_gapminder3)\n```\n\n#FILE I/O\n\nHere, my goal is to experiment with write_csv()/read_csv().\n\nTo do that, I first created something new: a country level summary of mean life expectancy in Europe. From my work in the previous section, I know that Europe has the highest life expectancy, but I don't have more fine-grained information about life expectancy at the country level.\n\n```{r}\ngap_Eur_lifeExp <- xOcn_gapminder %>%\n  filter(continent==\"Europe\") %>% #only keep Europe\n  droplevels() %>% #remove unused factor levels\n  group_by(country) %>% \n  summarise(lifeExp = mean(lifeExp)) %>% \n  arrange(desc(lifeExp))\nstr(gap_Eur_lifeExp)\nhead(gap_Eur_lifeExp)\n```\n\nLooking at the data, it looks like everything worked out as intentioned, with only European countries included, and mean life expectancy for each.\n\nNext, I tried the write_csv() function to write the data out.\n\n```{r}\nwrite_csv(gap_Eur_lifeExp, \"gap_Eur_lifeExp.csv\")\nsaveRDS(gap_Eur_lifeExp,\"gap_Eur_lifeExp.rds\")\n```\n\nAnd then, I read the data back in, this time using the read.csv function. I tried the read_csv function initially, but found that it returned the qualitative variables (country and continent) as characters, rather than factors. However, read.csv seemed to avoid that issue, and returned these variables as factors, as I would want them to be.\n\n```{r}\ngap_Eur_lifeExp_in_test <- read.csv(\"gap_Eur_lifeExp.csv\")\nstr(gap_Eur_lifeExp_in_test)\nhead(gap_Eur_lifeExp_in_test)\n```\n\nTaking a glance at the data, it all seemed to survive the trip back. Both are data.frames, however, the version that was read back in no longer appears to be a tibble.\n\n#VISUALIZATION DESIGN\n\nFirst, I tried doing a basic plot, where I used the data I generated in the previous section. I used this data because I had arranged it from highest to lowest life expectancy using arrange(), and wanted to explore whether this would be reflected in the figure.\n\n```{r}\np1 <- gap_Eur_lifeExp %>% \n  ggplot(aes(x=lifeExp, y=country)) +\n  geom_point()\np1\n```\n\nLooking at the figure, it's clear that arrange() has no effect, in that the order of countries on the y-axis is alphabetical, rather than being ordered in a meaningful way.\n\nWhat if I use this same arranged data, by try fct_order() in ggplot?\n\n```{r}\np2 <- gap_Eur_lifeExp %>% \n  ggplot(aes(x=lifeExp, y=fct_reorder(country, lifeExp))) +\n  geom_point()\np2\n```\n\nNow the y-axis is ordered in a meaningful way, from lowest mean life expectancy, to highest mean life expectancy.\n\nHowever, this is an extremely basic plot. So next, I remake this figure, using what I have learned in recent class meetings about visualization design and colour.\n\nFor this figure, I want to keep looking at life expectancy for Europe, but this time with data points from all of the years, along with mean life expectancy, to get an idea of change in life expectancy, but also to see how that mean value actually fits in.\n\n```{r}\np3 <- xOcn_gapminder %>%\n  filter(continent==\"Europe\") %>% #only keep Europe\n  droplevels() %>% #remove unused factor levels\n  group_by(country) %>% \n  ggplot(aes(x=lifeExp, y=fct_reorder(country, lifeExp))) +\n  geom_point(aes(colour=year)) +\n  scale_colour_distiller(palette=\"PuBuGn\", direction=1, \"Year\") +\n  scale_x_continuous(name=\"Life Expectancy\") +\n  scale_y_discrete(name=\"Country\") +\n  ggtitle(\"Life expectancy for European countries, 1952-2007.\") +\n  theme(plot.title = element_text(hjust = 0.5)) +\n  geom_point(data=gap_Eur_lifeExp, aes(x=lifeExp, y=country), colour=\"tomato3\", fill=\"tomato3\", shape=24) +\n  theme_bw()\np3\n```\n\nThe biggest take away from this figure is that most countries consistently enjoyed higher life expectancy in more recent years, with mean life expectancy (as depicted by the red triangles) falling somewhere close to the middle of the distribution of measurement points for each county. Beyond the aesthetical appeal of this plot, and the more informative labels and titles, I think the quality and richness of data visualization is probably the biggest difference between this plot and the more basic plot.\n\n#WRITING FIGURES TO FILE\n\n```{r}\nggsave(\"hw05_scatterplot-EuropeanCountries-vs-lifeExp.png\", p3)\n```\n\n![](hw05_scatterplot-EuropeanCountries-vs-lifeExp.png)\n\n\n\n",
    "created" : 1508542387996.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "910973782",
    "id" : "D84578FE",
    "lastKnownWriteTime" : 1508561610,
    "last_content_update" : 1508561610357,
    "path" : "C:/Users/Victoria/Desktop/STAT 545A/STAT545 Homework/STAT545-hw-Michalowski-Victoria/hw05/hw05.Rmd",
    "project_path" : "hw05/hw05.Rmd",
    "properties" : {
        "ignored_words" : "fct,ggplot,colour,aesthetical,github,gapminder,flavour,intentioned,forcats,csv,tibble\n",
        "last_setup_crc32" : "8FD28E461395aa5d",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}